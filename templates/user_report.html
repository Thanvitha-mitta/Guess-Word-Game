{% extends "base.html" %}
{% block content %}
<h2>User Report</h2>

<form method="GET" style="margin-bottom: 30px;">
    <div class="form-group" style="display: inline-block; margin-right: 20px;">
        <label for="username">Select User:</label>
        <select id="username" name="username">
            <option value="">-- Select User --</option>
            {% for user in all_users %}
                <option value="{{ user }}" {% if user == selected_username %}selected{% endif %}>{{ user }}</option>
            {% endfor %}
        </select>
    </div>
    <button type="submit" class="btn">Generate Report</button>
</form>

{% if user_data %}
<h3>Report for {{ selected_username }}</h3>
<table>
    <thead>
        <tr>
            <th>Date</th>
            <th>Words Tried</th>
            <th>Correct Guesses</th>
            <th>Success Rate</th>
        </tr>
    </thead>
    <tbody>
        {% for row in user_data %}
        <tr>
            <td>{{ row[0] }}</td>
            <td>{{ row[1] }}</td>
            <td>{{ row[2] }}</td>
            <td>{{ "%.1f"|format((row[2] / row[1] * 100) if row[1] > 0 else 0) }}%</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div style="margin-top: 30px;">
    {% set total_games = user_data|sum(attribute=1) %}
    {% set total_wins = user_data|sum(attribute=2) %}
    <div class="stats">
        <div class="stat-card">
            <div class="stat-number">{{ user_data|length }}</div>
            <div class="stat-label">Days Played</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ total_games }}</div>
            <div class="stat-label">Total Games</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ total_wins }}</div>
            <div class="stat-label">Total Wins</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ "%.1f"|format((total_wins / total_games * 100) if total_games > 0 else 0) }}%</div>
            <div class="stat-label">Overall Success Rate</div>
        </div>
    </div>
</div>
{% elif selected_username %}
<div style="text-align: center; padding: 40px;">
    <p>No data available for user "{{ selected_username }}".</p>
</div>
{% endif %}
{% endblock %}